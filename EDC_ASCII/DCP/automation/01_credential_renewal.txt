1. Credential Renewal (Renovación Automática)

   HOLDER (IDENTITY HUB)                            ISSUER (ISSUER SERVICE)
   +-----------------------+                        +-----------------------+
   | Credential Watchdog   |                        |                       |
   | (Background Task)     |                        |                       |
   |  (1) Scan Expiry      |                        |                       |
   | [Credential Store]    |                        |                       |
   | (Busca VCs próximas   |                        |                       |
   |  a expirar)           |                        |                       |
   |                       |                        |                       |
   |  (2) Trigger Renewal  |                        |                       |
   | [Credential Req Mgr]  |  (3) Renewal Request   | [Issuance API]        |
   | (Genera SI-Token)     | ---------------------> | (Recibe solicitud)    |
   | (Crea nueva solicitud)|   POST /credentials    | (Valida elegibilidad) |
   |                       |                        |                       |
   |                       |  (4) Deliver New VC    | [Issuance Process]    |
   | [Storage API]         | <--------------------- | (Genera nueva VC)     |
   | (Recibe VC renovada)  |   (VC Actualizada)     | (Entrega asíncrona)   |
   | (Actualiza Store)     |                        |                       |
   +-----------------------+                        +-----------------------+


Descripción Técnica:

El Identity Hub dispone de un mecanismo de vigilancia ("Watchdog") que monitorea la fecha de expiración de las credenciales almacenadas y solicita automáticamente una renovación antes de que caduquen.

(1) Scan Expiry: El módulo credential-watchdog ejecuta una tarea periódica (configurada vía edc.iam.credential.status.check.period). Consulta el CredentialStore buscando credenciales cuya fecha de expiración esté dentro del periodo de gracia configurado (edc.iam.credential.renewal.graceperiod, por defecto 7 días).

(2) Trigger Renewal: Si se detecta una credencial por vencer, el Watchdog activa el CredentialRequestManager. Este servicio prepara una nueva solicitud de emisión para el mismo tipo de credencial.

(3) Renewal Request: El Holder envía una CredentialRequest estándar al Issuer. Se autentica nuevamente con un token autofirmado (SI-Token) para probar que sigue controlando el DID.

(4) Deliver New VC: El Issuer procesa la solicitud (verificando que el usuario siga cumpliendo las políticas). Si es aprobado, genera una nueva Verifiable Credential con una fecha de expiración extendida y la entrega al endpoint de almacenamiento del Holder (modelo Push), completando el ciclo.